<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Optymalizator</title>

    <!-- Biblioteki zewnętrzne -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/9.4.4/math.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <!-- Alternatywne źródło dla Plotly, załaduje się tylko jeśli główne nie działa -->
    <script>
        window.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                if (typeof Plotly === 'undefined') {
                    console.log('Próba załadowania Plotly z alternatywnego źródła...');
                    var script = document.createElement('script');
                    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.24.2/plotly.min.js';
                    script.onload = function() {
                        console.log('Plotly załadowany z alternatywnego źródła');
                        
                        // Po wczytaniu Plotly, sprawdź czy funkcja visualizeResults powinna być uruchomiona
                        if (typeof AHP !== 'undefined' && AHP.shouldVisualizeResults) {
                            console.log('Uruchamianie odroczonej wizualizacji wyników...');
                            AHP.visualizeResults();
                            AHP.shouldVisualizeResults = false;
                        }
                    };
                    document.head.appendChild(script);
                }
            }, 1000); // Czekamy 1 sekundę, aby dać szansę głównej bibliotece
        });
    </script>
    <script src="solver.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome dla ikon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Własne style -->
    <link href="css/styles.css?v=1.4" rel="stylesheet">
    <link href="css/ahp.css?v=1.4" rel="stylesheet">
    <link href="css/cuttingstock.css?v=1.4" rel="stylesheet">
    
    <!-- Bezpośrednie styles dla tła i przycisków -->
    <style>
        body, .app-content, .app-main, .tool-content, .input-group, .main-result, .diagnostics-section, .detailed-results {
            background-image: url('asfalt-dark.png') !important;
            background-repeat: repeat !important;
        }
        
        .help-button {
            position: fixed !important;
            right: 20px !important;
            top: 23vh !important; /* Na tej samej wysokości co strzałka nawy */
            z-index: 1000 !important;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Nagłówek / Menu - od krawędzi do krawędzi -->
        <header class="app-header">
            <h1>Optymalizator</h1>
            <nav class="app-nav">
                <ul>
                    <li><button id="nav-ahp" onclick="App.switchToTool('ahp')">Kalkulator AHP</button></li>
                    <li><button id="nav-cutting-stock" onclick="App.switchToTool('cutting-stock')">Problem Rozkroju</button></li>
                    <li><button id="nav-production-opt" onclick="App.switchToTool('production-opt')">Optymalizacja Produkcji</button></li>
                </ul>
            </nav>
        </header>

        <!-- Główny kontener treści - od krawędzi do krawędzi -->
        <div class="app-content">
            <!-- Nawa boczna - lewa strona -->
            <aside id="app-sidebar" class="app-sidebar">
                <!-- AHP Sidebar -->
                <div id="ahp-sidebar-content" class="sidebar-content">
                    <!-- Sekcja kryteriów -->
                    <div class="sidebar-main-section">
                        <h3>Kryteria</h3>
                        
                        <!-- Sekcja z liczbą kryteriów -->
                        <div class="sidebar-section">
                            <div class="input-row">
                                <label>Liczba kryteriów (3-6):</label>
                                <input type="number" id="ahpNumCriteria" min="3" max="6" value="3">
                            </div>
                        </div>
                        
                        <!-- Sekcja z nazwami kryteriów -->
                        <div id="ahpCriteriaNames" class="sidebar-section">
                            <h3>Nazwy kryteriów</h3>
                            <div class="criteria-inputs-container"></div>
                        </div>
                    </div>
                    
                    <!-- Linia oddzielająca sekcje -->
                    <div class="sidebar-divider"></div>
                    
                    <!-- Sekcja opcji -->
                    <div class="sidebar-main-section">
                        <h3>Opcje</h3>
                        
                        <!-- Sekcja z liczbą opcji -->
                        <div class="sidebar-section">
                            <div class="input-row">
                                <label>Liczba opcji (2-6):</label>
                                <input type="number" id="ahpNumOptions" min="2" max="6" value="2">
                            </div>
                        </div>
                        
                        <!-- Sekcja z nazwami opcji -->
                        <div id="ahpOptionNames" class="sidebar-section">
                            <h3>Nazwy opcji</h3>
                            <div class="options-inputs-container"></div>
                        </div>
                    </div>
                </div>
            </aside>
            
            <!-- Przycisk do minimalizacji/maksymalizacji nawy -->
            <button id="sidebar-toggle" class="sidebar-toggle">
                <span class="arrow-icon"></span>
            </button>
            
            <!-- Główna treść - prawa strona -->
            <main class="app-main">
                <!-- AHP Tool -->
                <div id="tool-ahp" class="tool-content">
                    <div class="tool-header">
                        <h2>Kalkulator AHP</h2>
                        
                        <!-- Przełącznik interfejsu -->
                        <div id="ahp-interface-switch" class="interface-switch-container">
                            <div class="interface-switch">
                                <label>Wybierz tryb interfejsu:</label>
                                <div class="switch-options">
                                    <button id="matrix-interface" class="switch-option" title="Macierz porównań"><i class="fas fa-table"></i></button>
                                    <button id="simplified-interface" class="switch-option active" title="Uproszczony"><i class="fas fa-sliders-h"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Przycisk pomocy AHP -->
                    <button id="help-ahp" class="help-button" title="Pomoc AHP">?</button>
                    
                    <!-- Formularze porównań -->
                    <div id="ahpCriteriaComparisonMatrix" class="full-width-form"></div>
                    <div id="ahpOptionsComparisonSection" class="full-width-form"></div>
                    
                    <!-- Przycisk do obliczenia wyników -->
                    <div class="calculate-button-container">
                        <button id="calculate-ahp" class="calculate-button" onclick="AHP.calculate()">Oblicz wyniki AHP</button>
                    </div>
                    
                    <!-- Wyniki -->
                    <div class="results-area">
                        <div id="ahpResults" class="results"></div>
                        <div id="ahpVisualization" class="visualization-container"></div>
                    </div>
                </div>

                <!-- Cutting Stock Problem -->
                <div id="tool-cutting-stock" class="tool-content">
                    <h2>Problem Rozkroju</h2>
                    
                    <!-- Przycisk pomocy Problem Rozkroju -->
                    <button id="help-cutting-stock" class="help-button" title="Pomoc Problem Rozkroju">?</button>
                    
                    <div class="input-group">
                        <div class="input-row">
                            <label>Długość kłody (m):</label>
                            <input type="number" id="logLength" value="2.0" step="0.1">
                        </div>
                        <div class="input-row">
                            <label>Dokładna liczba sztuk:</label>
                            <input type="checkbox" id="exactCuts">
                        </div>
                        <div id="ordersList"></div>
                        <button onclick="CuttingStock.addOrderRow()">Dodaj zamówienie</button>
                    </div>
                    <button onclick="CuttingStock.calculate()">Oblicz optymalny podział</button>
                    <div id="cuttingStockResults" class="tool-content"></div>
                    <div id="cuttingStockVisualization" class="tool-content"></div>
                    <div id="cuttingStockLoadingIndicator" class="loading-indicator" style="display: none;">
                        <div class="spinner"></div>
                        <p>Trwa obliczanie optymalnego rozwiązania...</p>
                    </div>
                </div>

                <!-- Production Optimization -->
                <div id="tool-production-opt" class="tool-content">
                    <h2>Optymalizacja Produkcji</h2>
                    
                    <!-- Przycisk pomocy Optymalizacja Produkcji -->
                    <button id="help-production-opt" class="help-button" title="Pomoc Optymalizacja Produkcji">?</button>
                    
                    <div class="production-container">
                        <div class="production-sidebar">
                            <div class="input-group">
                                <h3>Ustawienia</h3>
                                <div class="input-row">
                                    <label for="numVars">Liczba produktów/zmiennych:</label>
                                    <input type="number" id="numVars" min="1" max="10" value="2">
                                    <button onclick="ProductionOpt.updateObjectiveFunction()" class="small-button">Zastosuj</button>
                                </div>
                                <div class="input-row">
                                    <label for="optimizationType">Typ optymalizacji:</label>
                                    <select id="optimizationType">
                                        <option value="max">Maksymalizacja (zysk)</option>
                                        <option value="min">Minimalizacja (koszty)</option>
                                    </select>
                                </div>
                                <div class="input-row">
                                    <label for="productNames">Nazwy produktów (oddzielone przecinkami):</label>
                                    <input type="text" id="productNames" placeholder="Produkt A, Produkt B, ...">
                                    <button onclick="ProductionOpt.applyProductNames()" class="small-button">Zastosuj</button>
                                </div>
                            </div>

                            <div class="input-group">
                                <h3>Funkcja celu (zyski/koszty jednostkowe)</h3>
                                <div id="objectiveFunction"></div>
                            </div>
                            
                            <div class="input-group">
                                <h3>Ograniczenia</h3>
                                <div class="constraints-description">
                                    <p>Przykłady ograniczeń:</p>
                                    <ul>
                                        <li>Maksymalna dostępność surowców</li>
                                        <li>Ograniczenia czasowe maszyn</li>
                                        <li>Minimalne/maksymalne ilości produktów</li>
                                        <li>Ograniczenia budżetowe</li>
                                    </ul>
                                </div>
                                <div id="constraints"></div>
                                <button onclick="ProductionOpt.addConstraint()" class="add-constraint-button">
                                    <span>+</span> Dodaj ograniczenie
                                </button>
                            </div>

                            <button onclick="ProductionOpt.calculate()" class="calculate-button">Oblicz optimum</button>
                        </div>

                        <div class="production-results">
                            <div class="results-header">
                                <h3>Wyniki Optymalizacji</h3>
                            </div>

                            <div id="productionOptSummary" style="display: none;" class="results-summary">
                                <h4>Podsumowanie</h4>
                                <div id="productionOptSummaryContent"></div>
                            </div>

                            <div id="productionOptResults" class="results-detail"></div>
                            <div id="productionOptVisualization" class="visualization-container"></div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Stopka - od krawędzi do krawędzi -->
        <footer class="app-footer">
            <p>Michał Kopeć 2025</p>
        </footer>
    </div>

    <!-- Okienka modalne pomocy -->
    <div id="help-modal-ahp" class="help-modal">
        <div class="help-modal-content">
            <button class="close-help-modal">&times;</button>
            <h3>Jak korzystać z Kalkulatora AHP</h3>
            <p>Analityczny Proces Hierarchiczny (AHP) to metoda wspomagania podejmowania decyzji wielokryterialnych. Oto jak korzystać z tego narzędzia:</p>
            
            <ol>
                <li><strong>Zdefiniuj kryteria</strong> - W lewym panelu wprowadź liczbę kryteriów (od 3 do 6) i nadaj im nazwy odpowiadające aspektom Twojej decyzji. (np. Cena, Jakość, Dostępność)</li>
                <li><strong>Zdefiniuj opcje</strong> - Wprowadź liczbę opcji (od 2 do 6) i nadaj im nazwy odpowiadające dostępnym wariantom wyboru. <br>(np. Produkt A, Produkt B, Samochód osobowy, Samochód ciężarowy)</li>
                <li><strong>Porównaj kryteria</strong> - Wybierz interfejs (macierzowy lub uproszczony) i określ względną ważność każdego kryterium względem innych.<br> (np. Cena jest ważniejsza od Jakości)</li>
                <li><strong>Porównaj opcje</strong> - Dla każdego kryterium określ, jak dobrze każda opcja spełnia dane kryterium w porównaniu z innymi opcjami.<br> (np. Produkt A jest lepszy od Produktu B)</li>
                <li><strong>Oblicz wyniki</strong> - Kliknij przycisk "Oblicz wyniki AHP", aby uzyskać ranking opcji i wizualizacje.</li>
            </ol>

            <h4>Wskazówki:</h4>
            <ul>
                <li>Skala porównań od 1 do 9 oznacza: 1 - równe znaczenie, 9 - skrajnie większe znaczenie.</li>
                <li>Wskaźnik spójności (CR) poniżej 0.1 oznacza, że Twoje porównania są spójne. Jeśli jest wyższy, rozważ ponowne przemyślenie niektórych porównań.</li>
                <li>Możesz przełączać się między interfejsami w dowolnym momencie - Twoje dane zostaną zachowane.</li>
                <li>Wyniki możesz pobrać w formacie CSV, JSON lub TXT do dalszej analizy.</li>
                <li><strong>Uwaga:</strong> Panel boczny zawiera istotne ustawienia dla metody AHP. Użyj go, aby zdefiniować liczbę i nazwy kryteriów oraz opcji przed przystąpieniem do porównań.</li>
            </ul>
        </div>
    </div>

    <div id="help-modal-cutting-stock" class="help-modal">
        <div class="help-modal-content">
            <button class="close-help-modal">&times;</button>
            <h3>Jak korzystać z narzędzia Problem Rozkroju</h3>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
        </div>
    </div>

    <div id="help-modal-production-opt" class="help-modal">
        <div class="help-modal-content">
            <button class="close-help-modal">&times;</button>
            <h3>Jak korzystać z narzędzia Optymalizacja Produkcji</h3>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
        </div>
    </div>

    <!-- Własne skrypty -->
    <script src="script.js"></script>
    <script src="ahp.js"></script>
    <script src="cuttingStock.js"></script>
    <script src="productionOpt.js"></script>
    
    <!-- Skrypt obsługujący zwijanie/rozwijanie nawy bocznej -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const sidebar = document.getElementById('app-sidebar');
            const sidebarToggle = document.getElementById('sidebar-toggle');
            const mainContent = document.querySelector('.app-main');
            
            // Naprawiona obsługa przycisku zwijania/rozwijania
            if (sidebarToggle) {
                sidebarToggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    if (sidebar) {
                        sidebar.classList.toggle('sidebar-minimized');
                        
                        // Dostosuj główną zawartość od razu
                        if (sidebar.classList.contains('sidebar-minimized')) {
                            sidebarToggle.querySelector('.arrow-icon').innerHTML = '▶';
                        } else {
                            sidebarToggle.querySelector('.arrow-icon').innerHTML = '◀';
                        }
                    }
                });
            }
            
            // Zapobiegaj zamykaniu nawy podczas kliknięcia wewnątrz niej
            if (sidebar) {
                sidebar.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
                
                // Zapobiegaj zamykaniu nawy podczas wpisywania tekstu w polach formularzy
                const formInputs = sidebar.querySelectorAll('input, select, textarea');
                formInputs.forEach(function(input) {
                    input.addEventListener('focus', function(e) {
                        e.stopPropagation();
                        // Upewnij się, że nawa pozostaje otwarta
                        sidebar.classList.remove('sidebar-minimized');
                        if (sidebarToggle.querySelector('.arrow-icon')) {
                            sidebarToggle.querySelector('.arrow-icon').innerHTML = '◀';
                        }
                    });
                    
                    // Zapobiegaj zamykaniu nawy podczas wpisywania tekstu
                    input.addEventListener('click', function(e) {
                        e.stopPropagation();
                    });
                    
                    input.addEventListener('touchstart', function(e) {
                        e.stopPropagation();
                    });
                });
            }
            
            // Funkcja dostosowująca UI na urządzeniach mobilnych
            function adjustMobileUI() {
                if (window.innerWidth <= 992) {
                    // Urządzenie mobilne - nawa rozwinięta (zmiana zachowania)
                    if (sidebar && !sidebar.contains(document.activeElement)) {
                        // Nawa domyślnie rozwinięta na urządzeniach mobilnych
                        sidebar.classList.remove('sidebar-minimized');
                        sidebarToggle.querySelector('.arrow-icon').innerHTML = '◀';
                    }
                } else {
                    // Desktop - nawa rozwinięta
                    if (sidebar) {
                        sidebar.classList.remove('sidebar-minimized');
                        sidebarToggle.querySelector('.arrow-icon').innerHTML = '◀';
                    }
                }
            }
            
            // Wywołaj funkcję od razu i przy zmianie rozmiaru okna
            adjustMobileUI();
            
            // Throttle dla event resize
            let resizeTimeout;
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(adjustMobileUI, 100);
            });
        });
    </script>
    
    <!-- Kod sprawdzający załadowanie Plotly -->
    <script>
        window.addEventListener('load', function() {
            if (typeof Plotly === 'undefined') {
                console.error('Błąd: Biblioteka Plotly nie została załadowana poprawnie!');
                const vizContainers = document.querySelectorAll('.visualization-container');
                vizContainers.forEach(container => {
                    container.innerHTML = '<div class="error-message">Nie można załadować biblioteki do wizualizacji. Odśwież stronę lub sprawdź połączenie z internetem.</div>';
                });
            } else {
                console.log('Biblioteka Plotly została załadowana poprawnie.');
            }
        });
    </script>
</body>
</html> 